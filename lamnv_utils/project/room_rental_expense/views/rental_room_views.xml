<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Rental Room List View -->
    <record id="view_rental_room_list" model="ir.ui.view">
            <field name="name">rental.room.list</field>
            <field name="model">rental.room</field>
            <field name="arch" type="xml">
                <list string="Danh S√°ch Ph√≤ng Tr·ªç" decoration-info="end_date and end_date &lt; current_date">
                    <field name="name"/>
                    <field name="address"/>
                    <field name="landlord_name"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="total_invoiced" widget="vnd_currency" sum="Total Invoiced"/>
                    <field name="total_paid" widget="vnd_currency" sum="Total Paid"/>
                    <field name="total_remaining" widget="vnd_currency" sum="Remaining"/>
                </list>
            </field>
        </record>

        <!-- Rental Room Form View -->
        <record id="view_rental_room_form" model="ir.ui.view">
            <field name="name">rental.room.form</field>
            <field name="model">rental.room</field>
            <field name="arch" type="xml">
                <form string="Ph√≤ng Tr·ªç">
                    <header>
                        <button name="action_view_invoices" type="object" string="Xem H√≥a ƒê∆°n" class="oe_highlight"/>
                        <button name="action_view_meter_readings" type="object" string="Xem Ch·ªâ S·ªë" class="oe_highlight"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" name="action_view_invoices" type="object" icon="fa-file-text">
                                <field string="H√≥a ƒê∆°n" name="invoice_ids" widget="statinfo"/>
                            </button>
                            <button class="oe_stat_button" name="action_view_meter_readings" type="object" icon="fa-bar-chart">
                                <field string="Ch·ªâ S·ªë" name="meter_reading_ids" widget="statinfo"/>
                            </button>
                        </div>

                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="T√™n Ph√≤ng"/>
                            </h1>
                        </div>

                        <notebook>
                            <!-- Tab: Th√¥ng Tin C∆° B·∫£n -->
                            <page string="Th√¥ng Tin C∆° B·∫£n" name="basic_info">
                                <group>
                                    <group>
                                        <field name="room_number" string="S·ªë Ph√≤ng"/>
                                        <field name="building_name" string="T√™n Nh√†"/>
                                        <field name="room_type" string="Lo·∫°i Ph√≤ng"/>
                                        <field name="area" string="Di·ªán T√≠ch (m¬≤)" widget="number_format"/>
                                        <field name="default_rent" string="Ti·ªÅn Thu√™ M·∫∑c ƒê·ªãnh" widget="vnd_currency"/>
                                    </group>
                                    <group>
                                        <field name="start_date" string="Ng√†y B·∫Øt ƒê·∫ßu"/>
                                        <field name="end_date" string="Ng√†y K·∫øt Th√∫c"/>
                                        <field name="address" string="ƒê·ªãa Ch·ªâ"/>
                                        <field name="image" widget="image" class="oe_avatar" string="·∫¢nh Ph√≤ng"/>
                                    </group>
                                </group>
                                <field name="description" placeholder="M√¥ t·∫£ ph√≤ng..." string="M√¥ T·∫£"/>
                                <field name="utilities_included" placeholder="Ti·ªán √≠ch bao g·ªìm..." string="Ti·ªán √çch"/>
                            </page>

                            <!-- Tab: Ch·ªß Ph√≤ng -->
                            <page string="Th√¥ng Tin Ch·ªß Ph√≤ng" name="landlord_info">
                                <group>
                                    <group>
                                        <field name="landlord_name" string="T√™n Ch·ªß Ph√≤ng"/>
                                        <field name="landlord_phone" string="S·ªë ƒêi·ªán Tho·∫°i"/>
                                        <field name="landlord_email" string="Email"/>
                                        <field name="landlord_favorite" string="Y√™u Th√≠ch"/>
                                    </group>
                                    <group>
                                        <field name="landlord_bank_name" string="Ng√¢n H√†ng"/>
                                        <field name="landlord_bank_account" string="T√†i Kho·∫£n Ng√¢n H√†ng"/>
                                    </group>
                                </group>
                            </page>

                            <!-- Tab: H√≥a ƒê∆°n -->
                            <page string="H√≥a ƒê∆°n" name="invoices">
                                <field name="invoice_ids" context="{'default_room_id': id}">
                                    <list string="Danh S√°ch H√≥a ƒê∆°n">
                                        <field name="invoice_number"/>
                                        <field name="invoice_month"/>
                                        <field name="total_amount" widget="vnd_currency"/>
                                        <field name="paid_amount" widget="vnd_currency"/>
                                        <field name="remaining_amount" widget="vnd_currency"/>
                                        <field name="status"/>
                                    </list>
                                </field>
                            </page>

                            <!-- Tab: Ch·ªâ S·ªë C√¥ng T∆° -->
                            <page string="Ch·ªâ S·ªë C√¥ng T∆°" name="meter_readings">
                                <field name="meter_reading_ids" context="{'default_room_id': id}">
                                    <list string="Danh S√°ch Ch·ªâ S·ªë">
                                        <field name="reading_date"/>
                                        <field name="electric_current" widget="number_format"/>
                                        <field name="electric_usage" widget="number_format"/>
                                        <field name="water_current" widget="number_format"/>
                                        <field name="water_usage" widget="number_format"/>
                                    </list>
                                </field>
                            </page>

                            <!-- Tab: Chi Ph√≠ -->
                            <page string="Chi Ph√≠" name="expenses">
                                <field name="expense_ids" context="{'default_room_id': id}">
                                    <list string="Danh S√°ch Chi Ph√≠">
                                        <field name="expense_date"/>
                                        <field name="category"/>
                                        <field name="description"/>
                                        <field name="amount" widget="vnd_currency"/>
                                    </list>
                                </field>
                            </page>

                            <!-- Tab: Ti·ªÅn C·ªçc -->
                            <page string="Ti·ªÅn C·ªçc" name="deposits">
                                <field name="deposit_ids" context="{'default_room_id': id}">
                                    <list string="Danh S√°ch Ti·ªÅn C·ªçc">
                                        <field name="deposit_date"/>
                                        <field name="deposit_amount" widget="vnd_currency"/>
                                        <field name="status"/>
                                        <field name="return_amount" widget="vnd_currency"/>
                                    </list>
                                </field>
                            </page>

                            <!-- Tab: S·ª± C·ªë -->
                            <page string="S·ª± C·ªë" name="issues">
                                <field name="issue_ids" context="{'default_room_id': id}">
                                    <list string="Danh S√°ch S·ª± C·ªë">
                                        <field name="issue_date"/>
                                        <field name="category"/>
                                        <field name="severity"/>
                                        <field name="status"/>
                                    </list>
                                </field>
                            </page>

                            <!-- Tab: Ghi Ch√∫ -->
                            <page string="Ghi Ch√∫" name="notes">
                                <field name="note" placeholder="Ghi ch√∫ th√™m..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Rental Room Kanban View -->
        <record id="view_rental_room_kanban" model="ir.ui.view">
            <field name="name">rental.room.kanban</field>
            <field name="model">rental.room</field>
            <field name="arch" type="xml">
                <kanban string="Ph√≤ng Tr·ªç" class="o_kanban_small_column">
                    <style>
                        /* CSS ƒë·ªÉ format s·ªë ti·ªÅn trong Kanban */
                        .vnd-currency {
                            position: relative;
                        }
                        .vnd-currency::after {
                            content: " ‚Ç´";
                        }
                    </style>
                    <field name="id"/>
                    <field name="name"/>
                    <field name="room_number"/>
                    <field name="building_name"/>
                    <field name="landlord_name"/>
                    <field name="landlord_phone"/>
                    <field name="area"/>
                    <field name="room_type"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="default_rent"/>
                    <field name="total_invoiced"/>
                    <field name="total_paid"/>
                    <field name="total_remaining"/>
                    <field name="total_invoiced_fmt"/>
                    <field name="total_remaining_fmt"/>
                    <field name="default_rent_fmt"/>
                    <field name="invoice_ids"/>
                    <field name="meter_reading_ids"/>
                    <field name="image"/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_card oe_kanban_global_click" style="border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; margin: 8px;">
                                <!-- Header with room image and status -->
                                <div class="oe_kanban_card_header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 12px 12px 0 0; position: relative;">
                                    <!-- Room Image -->
                                    <div style="position: absolute; top: 10px; right: 10px;">
                                        <img t-if="record.image.raw_value" 
                                             t-att-src="'/web/image/rental.room/'+record.id.value+'/image'" 
                                             t-att-alt="'·∫¢nh ph√≤ng ' + record.name.value"
                                             style="width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; object-fit: cover;"/>
                                        <div t-else="" style="width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 18px;">
                                            üè†
                                        </div>
                                    </div>
                                    
                                    <!-- Room Title -->
                                    <div style="margin-right: 55px;">
                                        <h3 style="margin: 0; font-size: 16px; font-weight: bold;">
                                            <t t-esc="record.name.value"/>
                                        </h3>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 2px;">
                                            <span t-if="record.room_number.value">Ph√≤ng <t t-esc="record.room_number.value"/> ‚Ä¢ </span>
                                            <span t-esc="record.room_type.value" style="text-transform: capitalize;"/>
                                            <span t-if="record.area.value"> ‚Ä¢ <t t-esc="record.area.value"/>m¬≤</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Status Badge -->
                                    <div t-if="record.end_date.value" style="position: absolute; top: -8px; left: 15px;">
                                        <span class="badge badge-warning" style="font-size: 10px; padding: 4px 8px; border-radius: 12px;">
                                            S·∫Øp h·∫øt h·∫°n
                                        </span>
                                    </div>
                                </div>

                                <!-- Body Content -->
                                <div class="oe_kanban_card_body" style="padding: 15px;">
                                    <!-- Building Info -->
                                    <div style="margin-bottom: 12px;">
                                        <div style="display: flex; align-items: center; margin-bottom: 6px;">
                                            <i class="fa fa-building-o" style="color: #6c757d; margin-right: 8px; width: 16px;"></i>
                                            <span style="font-weight: 500; color: #495057;">
                                                <t t-if="record.building_name.value" t-esc="record.building_name.value"/>
                                                <t t-else="">Ch∆∞a c√≥ th√¥ng tin</t>
                                            </span>
                                        </div>
                                        <div style="display: flex; align-items: center;">
                                            <i class="fa fa-user" style="color: #6c757d; margin-right: 8px; width: 16px;"></i>
                                            <span style="color: #6c757d; font-size: 13px;">
                                                <t t-if="record.landlord_name.value" t-esc="record.landlord_name.value"/>
                                                <t t-else="">Ch∆∞a c√≥ th√¥ng tin</t>
                                            </span>
                                            <span t-if="record.landlord_phone.value" style="margin-left: auto; color: #28a745; font-size: 12px;">
                                                üìû <t t-esc="record.landlord_phone.value"/>
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Financial Summary -->
                                    <div style="background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                            <span style="font-size: 12px; color: #6c757d; font-weight: 500;">T√åNH H√åNH T√ÄI CH√çNH</span>
                                            <span t-if="record.default_rent.value" style="font-size: 11px; color: #6c757d;">
                                                Ti·ªÅn ph√≤ng: <strong><t t-esc="record.default_rent_fmt.value"/> ‚Ç´</strong>
                                            </span>
                                        </div>
                                        
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                            <!-- Total Invoiced -->
                                            <div style="text-align: center; padding: 8px; background: white; border-radius: 6px; border-left: 3px solid #007bff;">
                                                <div style="font-size: 11px; color: #6c757d; margin-bottom: 2px;">T·ªïng h√≥a ƒë∆°n</div>
                                                <div style="font-size: 13px; font-weight: bold; color: #007bff;">
                                                    <t t-esc="record.total_invoiced_fmt.value"/> ‚Ç´
                                                </div>
                                            </div>
                                            
                                            <!-- Remaining Amount -->
                                            <div t-attf-style="text-align: center; padding: 8px; background: white; border-radius: 6px; border-left: 3px solid #{record.total_remaining.raw_value > 0 ? '#dc3545' : '#28a745'};">
                                                <div style="font-size: 11px; color: #6c757d; margin-bottom: 2px;">
                                                    <t t-if="record.total_remaining.raw_value > 0">C√≤n n·ª£</t>
                                                    <t t-else="">ƒê√£ thanh to√°n</t>
                                                </div>
                                                <div t-attf-style="font-size: 13px; font-weight: bold; color: #{record.total_remaining.raw_value > 0 ? '#dc3545' : '#28a745'};">
                                                    <t t-if="record.total_remaining.raw_value > 0">
                                                        <t t-esc="record.total_remaining_fmt.value"/> ‚Ç´
                                                    </t>
                                                    <t t-else="">‚úì Ho√†n t·∫•t</t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Quick Info -->
                                    <div style="display: flex; gap: 6px; margin-top: 10px;">
                                        <div style="flex: 1; padding: 6px 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; text-align: center;">
                                            üí∞ <strong t-esc="record.invoice_ids.raw_value.length"/> h√≥a ƒë∆°n
                                        </div>
                                        <div style="flex: 1; padding: 6px 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; font-size: 11px; text-align: center;">
                                            üìä <strong t-esc="record.meter_reading_ids.raw_value.length"/> ch·ªâ s·ªë
                                        </div>
                                    </div>

                                    <!-- Timeline Info -->
                                    <div t-if="record.start_date.value" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e9ecef;">
                                        <div style="font-size: 11px; color: #6c757d; display: flex; align-items: center;">
                                            <i class="fa fa-calendar" style="margin-right: 6px;"></i>
                                            T·ª´ <strong t-esc="record.start_date.value"/>
                                            <span t-if="record.end_date.value"> ƒë·∫øn <strong t-esc="record.end_date.value"/></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Action: Rental Room -->
        <record id="action_rental_room" model="ir.actions.act_window">
            <field name="name">Ph√≤ng Tr·ªç</field>
            <field name="res_model">rental.room</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    T·∫°o ph√≤ng tr·ªç m·ªõi
                </p>
            </field>
        </record>

    </data>
</odoo>
